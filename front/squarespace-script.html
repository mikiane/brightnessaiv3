<!-- Brightness - Remplissage conversation dans formulaire -->
<script>
(function(){
  'use strict';
  
  console.log('ðŸŸ¢ Brightness Script V7 - Textarea');
  
  // Parsing manuel du paramÃ¨tre conversation
  function getConversation() {
    const search = window.location.search;
    if (!search) return null;
    
    const match = search.match(/[?&]conversation=([^&]*)/);
    if (match && match[1]) {
      try {
        const decoded = decodeURIComponent(match[1]);
        console.log('âœ… Conversation trouvÃ©e:', decoded.length, 'caractÃ¨res');
        return decoded;
      } catch(e) {
        console.log('âŒ Erreur dÃ©codage:', e.message);
      }
    }
    
    console.log('â„¹ï¸ Pas de conversation dans l\'URL');
    return null;
  }
  
  const conversation = getConversation();
  
  if (conversation) {
    // Attendre que le DOM soit prÃªt
    window.addEventListener('DOMContentLoaded', function() {
      console.log('ðŸ“„ DOM chargÃ©, recherche du textarea...');
      
      setTimeout(function() {
        // Trouver le textarea "Demande spÃ©cifique" par son ID
        const textarea = document.querySelector('#textarea-9d89d3c5-7bc9-46d2-8fae-573e726fe183-field');
        
        if (textarea) {
          // Remplir le champ
          textarea.value = conversation;
          
          // DÃ©clencher les Ã©vÃ©nements pour que Squarespace dÃ©tecte le changement
          textarea.dispatchEvent(new Event('input', { bubbles: true }));
          textarea.dispatchEvent(new Event('change', { bubbles: true }));
          
          console.log('âœ… Textarea rempli avec', conversation.length, 'caractÃ¨res');
          
          // Scroll vers le champ pour que l'utilisateur le voie
          setTimeout(() => {
            textarea.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }, 500);
          
          // Ajouter un bandeau de confirmation
          const form = textarea.closest('form');
          if (form && !form.querySelector('.brightness-notice')) {
            const notice = document.createElement('div');
            notice.className = 'brightness-notice';
            notice.style.cssText = 'background:#e8f5e9;border-left:4px solid #4caf50;padding:15px;margin:15px 0;border-radius:8px;font-size:14px;font-family:system-ui;';
            notice.innerHTML = '<strong>âœ“ Conversation importÃ©e</strong><br>Votre Ã©change avec l\'assistant a Ã©tÃ© prÃ©-rempli dans "Demande spÃ©cifique" (' + conversation.length + ' caractÃ¨res).';
            
            const firstField = form.querySelector('.field-list');
            if (firstField) {
              form.insertBefore(notice, firstField);
            }
            
            console.log('âœ… Bandeau de confirmation affichÃ©');
          }
        } else {
          console.log('âŒ Textarea "Demande spÃ©cifique" non trouvÃ©');
          console.log('   Textareas disponibles:', document.querySelectorAll('textarea').length);
          
          // Liste tous les textareas pour debug
          document.querySelectorAll('textarea').forEach(ta => {
            console.log('   - ID:', ta.id, 'Name:', ta.name);
          });
        }
      }, 2000); // 2 secondes pour Ãªtre sÃ»r que le formulaire est chargÃ©
    });
  }
})();
</script>
<!-- FIN Brightness -->
